<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ExistentialQuantification #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE NumericUnderscores #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-comment">-- | This module provides a test watchdog - an utility monitoring test cases and killing them if they don't</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- finish in time. 'Watchdog' thread runs in the background, and after specified timeout, it throws</span><span>
</span><span id="line-11"></span><span class="hs-comment">-- 'WatchdogException' to the target thread. A user is able to 'kickWatchdog', which delays the killing and</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- 'poisonWatchdog' which stops the watchdog.</span><span>
</span><span id="line-13"></span><span class="hs-comment">--</span><span>
</span><span id="line-14"></span><span class="hs-comment">-- To wrap a test case in a watchdog just use</span><span>
</span><span id="line-15"></span><span class="hs-comment">--</span><span>
</span><span id="line-16"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-17"></span><span class="hs-comment">-- runWithWatchdog watchdogConfig $ \\watchdog -&gt; do</span><span>
</span><span id="line-18"></span><span class="hs-comment">--   -- body of your test case</span><span>
</span><span id="line-19"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-20"></span><span class="hs-comment">--</span><span>
</span><span id="line-21"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Hedgehog.Extras.Test.TestWatchdog</span><span>
</span><span id="line-22"></span><span>  </span><span class="hs-special">(</span><span>
</span><span id="line-23"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Wrap in watchdog</span></span><span>
</span><span id="line-24"></span><span>    </span><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#runWithWatchdog_"><span class="hs-identifier">runWithWatchdog_</span></a></span><span>
</span><span id="line-25"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#runWithWatchdog"><span class="hs-identifier">runWithWatchdog</span></a></span><span>
</span><span id="line-26"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#runWithDefaultWatchdog_"><span class="hs-identifier">runWithDefaultWatchdog_</span></a></span><span>
</span><span id="line-27"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#runWithDefaultWatchdog"><span class="hs-identifier">runWithDefaultWatchdog</span></a></span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Watchdog control</span></span><span>
</span><span id="line-30"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#kickWatchdog"><span class="hs-identifier">kickWatchdog</span></a></span><span>
</span><span id="line-31"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#poisonWatchdog"><span class="hs-identifier">poisonWatchdog</span></a></span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Types</span></span><span>
</span><span id="line-34"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#Watchdog"><span class="hs-identifier">Watchdog</span></a></span><span>
</span><span id="line-35"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#WatchdogConfig"><span class="hs-identifier">WatchdogConfig</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#WatchdogException"><span class="hs-identifier">WatchdogException</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Low level API</span></span><span>
</span><span id="line-39"></span><span>  </span><span class="hs-comment">-- | There is also a lower-level API available, giving the ability to provide target thread ID, which watchdog</span><span>
</span><span id="line-40"></span><span>  </span><span class="hs-comment">-- will try to kill.</span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#makeWatchdog"><span class="hs-identifier">makeWatchdog</span></a></span><span>
</span><span id="line-43"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#runWatchdog"><span class="hs-identifier">runWatchdog</span></a></span><span>
</span><span id="line-44"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">Control.Concurrent</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">myThreadId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">threadDelay</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">throwTo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/stm-2.5.0.2/src"><span class="hs-identifier">Control.Concurrent.STM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">atomically</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/stm-2.5.0.2/src"><span class="hs-identifier">Control.Concurrent.STM.TChan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/stm-2.5.0.2/src"><span class="hs-identifier">TChan</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/stm-2.5.0.2/src"><span class="hs-identifier">newTChanIO</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/stm-2.5.0.2/src"><span class="hs-identifier">tryReadTChan</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/stm-2.5.0.2/src"><span class="hs-identifier">writeTChan</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">Control.Exception</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">Exception</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">Control.Monad.IO.Class</span></a></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/time-1.11.1.1/src"><span class="hs-identifier">Data.Time</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/time-1.11.1.1/src"><span class="hs-identifier">NominalDiffTime</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/time-1.11.1.1/src"><span class="hs-identifier">UTCTime</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/time-1.11.1.1/src"><span class="hs-identifier">diffUTCTime</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/time-1.11.1.1/src"><span class="hs-identifier">getCurrentTime</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>                   </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/time-1.11.1.1/src"><span class="hs-identifier">nominalDiffTimeToSeconds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">GHC.Conc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">ThreadId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">GHC.Stack</span></a></span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.Base</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadBase</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Control</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadBaseControl</span></span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Hedgehog.Extras.Test.Concurrent.html"><span class="hs-identifier">Hedgehog.Extras.Test.Concurrent</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">H</span></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">Prelude</span></a></span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span class="hs-comment">-- | Configuration for the watchdog.</span><span>
</span><span id="line-62"></span><span class="hs-keyword">newtype</span><span> </span><span id="WatchdogConfig"><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#WatchdogConfig"><span class="hs-identifier hs-var">WatchdogConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="WatchdogConfig"><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#WatchdogConfig"><span class="hs-identifier hs-var">WatchdogConfig</span></a></span></span><span>
</span><span id="line-63"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="watchdogTimeout"><span class="annot"><span class="annottext">WatchdogConfig -&gt; Int
</span><a href="Hedgehog.Extras.Test.TestWatchdog.html#watchdogTimeout"><span class="hs-identifier hs-var hs-var">watchdogTimeout</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-comment">-- ^ Timeout in seconds after which watchdog will kill the test case</span><span>
</span><span id="line-64"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span class="hs-comment">-- | Default watchdog configuration with 10 minutes timeout.</span><span>
</span><span id="line-67"></span><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#defaultWatchdogConfig"><span class="hs-identifier hs-type">defaultWatchdogConfig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#WatchdogConfig"><span class="hs-identifier hs-type">WatchdogConfig</span></a></span><span>
</span><span id="line-68"></span><span id="defaultWatchdogConfig"><span class="annot"><span class="annottext">defaultWatchdogConfig :: WatchdogConfig
</span><a href="Hedgehog.Extras.Test.TestWatchdog.html#defaultWatchdogConfig"><span class="hs-identifier hs-var hs-var">defaultWatchdogConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#WatchdogConfig"><span class="hs-identifier hs-type">WatchdogConfig</span></a></span><span>
</span><span id="line-69"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">watchdogTimeout :: Int
</span><a href="Hedgehog.Extras.Test.TestWatchdog.html#watchdogTimeout"><span class="hs-identifier hs-var">watchdogTimeout</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">600</span></span><span>
</span><span id="line-70"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span class="hs-comment">-- | A watchdog instance. See the module header for more detailed description.</span><span>
</span><span id="line-73"></span><span class="hs-keyword">data</span><span> </span><span id="Watchdog"><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#Watchdog"><span class="hs-identifier hs-var">Watchdog</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Watchdog"><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#Watchdog"><span class="hs-identifier hs-var">Watchdog</span></a></span></span><span>
</span><span id="line-74"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="watchdogConfig"><span class="annot"><span class="annottext">Watchdog -&gt; WatchdogConfig
</span><a href="Hedgehog.Extras.Test.TestWatchdog.html#watchdogConfig"><span class="hs-identifier hs-var hs-var">watchdogConfig</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#WatchdogConfig"><span class="hs-identifier hs-type">WatchdogConfig</span></a></span><span>
</span><span id="line-75"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="watchedThreadId"><span class="annot"><span class="annottext">Watchdog -&gt; ThreadId
</span><a href="Hedgehog.Extras.Test.TestWatchdog.html#watchedThreadId"><span class="hs-identifier hs-var hs-var">watchedThreadId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">ThreadId</span></a></span><span> </span><span class="hs-comment">-- ^ monitored thread id</span><span>
</span><span id="line-76"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="startTime"><span class="annot"><span class="annottext">Watchdog -&gt; UTCTime
</span><a href="Hedgehog.Extras.Test.TestWatchdog.html#startTime"><span class="hs-identifier hs-var hs-var">startTime</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/time-1.11.1.1/src"><span class="hs-identifier hs-type">UTCTime</span></a></span><span> </span><span class="hs-comment">-- ^ watchdog creation time</span><span>
</span><span id="line-77"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="kickChan"><span class="annot"><span class="annottext">Watchdog -&gt; TChan WatchdogCommand
</span><a href="Hedgehog.Extras.Test.TestWatchdog.html#kickChan"><span class="hs-identifier hs-var hs-var">kickChan</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/stm-2.5.0.2/src"><span class="hs-identifier hs-type">TChan</span></a></span><span> </span><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#WatchdogCommand"><span class="hs-identifier hs-type">WatchdogCommand</span></a></span><span> </span><span class="hs-comment">-- ^ a queue of watchdog commands</span><span>
</span><span id="line-78"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679128293"><span id="local-6989586621679128296"><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#Watchdog"><span class="hs-identifier hs-type">Watchdog</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-81"></span><span>  </span><span id="local-6989586621679128283"><span class="annot"><span class="annottext">show :: Watchdog -&gt; String
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></a></span></span><span> </span><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#Watchdog"><span class="hs-identifier hs-type">Watchdog</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">watchdogConfig :: Watchdog -&gt; WatchdogConfig
</span><a href="Hedgehog.Extras.Test.TestWatchdog.html#watchdogConfig"><span class="hs-identifier hs-var">watchdogConfig</span></a></span><span class="hs-glyph">=</span><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#WatchdogConfig"><span class="hs-identifier hs-type">WatchdogConfig</span></a></span><span class="hs-special">{</span><span id="local-6989586621679128281"><span class="annot"><span class="annottext">Int
watchdogTimeout :: Int
watchdogTimeout :: WatchdogConfig -&gt; Int
</span><a href="#local-6989586621679128281"><span class="hs-identifier hs-var hs-var">watchdogTimeout</span></a></span></span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679128280"><span class="annot"><span class="annottext">UTCTime
startTime :: UTCTime
startTime :: Watchdog -&gt; UTCTime
</span><a href="#local-6989586621679128280"><span class="hs-identifier hs-var hs-var">startTime</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679128279"><span class="annot"><span class="annottext">ThreadId
watchedThreadId :: ThreadId
watchedThreadId :: Watchdog -&gt; ThreadId
</span><a href="#local-6989586621679128279"><span class="hs-identifier hs-var hs-var">watchedThreadId</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span>
</span><span id="line-82"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Watchdog with timeout &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679128281"><span class="hs-identifier hs-var">watchdogTimeout</span></a></span><span>
</span><span id="line-83"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;, started at &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621679128280"><span class="hs-identifier hs-var">startTime</span></a></span><span>
</span><span id="line-84"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;, watching thread ID &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">ThreadId
</span><a href="#local-6989586621679128279"><span class="hs-identifier hs-var">watchedThreadId</span></a></span><span>
</span><span id="line-85"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span class="hs-comment">-- | Create manually a new watchdog, providing the target thread ID. After all watchdog timeouts expire,</span><span>
</span><span id="line-88"></span><span class="hs-comment">-- the target thread will get 'WatchdogException' thrown to it asynchronously (using 'throwTo').</span><span>
</span><span id="line-89"></span><span id="local-6989586621679128409"><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#makeWatchdog"><span class="hs-identifier hs-type">makeWatchdog</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadBase</span></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679128409"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-90"></span><span>             </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#WatchdogConfig"><span class="hs-identifier hs-type">WatchdogConfig</span></a></span><span>
</span><span id="line-91"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">ThreadId</span></a></span><span> </span><span class="hs-comment">-- ^ thread id which will get killed after all kicks expire</span><span>
</span><span id="line-92"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679128409"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#Watchdog"><span class="hs-identifier hs-type">Watchdog</span></a></span></span><span>
</span><span id="line-93"></span><span id="makeWatchdog"><span class="annot"><span class="annottext">makeWatchdog :: forall (m :: * -&gt; *).
MonadBase IO m =&gt;
WatchdogConfig -&gt; ThreadId -&gt; m Watchdog
</span><a href="Hedgehog.Extras.Test.TestWatchdog.html#makeWatchdog"><span class="hs-identifier hs-var hs-var">makeWatchdog</span></a></span></span><span> </span><span id="local-6989586621679128263"><span class="annot"><span class="annottext">WatchdogConfig
</span><a href="#local-6989586621679128263"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span id="local-6989586621679128262"><span class="annot"><span class="annottext">ThreadId
</span><a href="#local-6989586621679128262"><span class="hs-identifier hs-var">watchedThreadId'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (b :: * -&gt; *) (m :: * -&gt; *) &#945;. MonadBase b m =&gt; b &#945; -&gt; m &#945;
</span><span class="hs-identifier hs-var">liftBase</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-94"></span><span>  </span><span id="local-6989586621679128260"><span class="annot"><span class="annottext">Watchdog
</span><a href="#local-6989586621679128260"><span class="hs-identifier hs-var">watchdog</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WatchdogConfig
-&gt; ThreadId -&gt; UTCTime -&gt; TChan WatchdogCommand -&gt; Watchdog
</span><a href="Hedgehog.Extras.Test.TestWatchdog.html#Watchdog"><span class="hs-identifier hs-var">Watchdog</span></a></span><span> </span><span class="annot"><span class="annottext">WatchdogConfig
</span><a href="#local-6989586621679128263"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">ThreadId
</span><a href="#local-6989586621679128262"><span class="hs-identifier hs-var">watchedThreadId'</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">IO UTCTime
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/time-1.11.1.1/src"><span class="hs-identifier hs-var">getCurrentTime</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. IO (TChan a)
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/stm-2.5.0.2/src"><span class="hs-identifier hs-var">newTChanIO</span></a></span><span>
</span><span id="line-95"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadIO m =&gt; Watchdog -&gt; m ()
</span><a href="Hedgehog.Extras.Test.TestWatchdog.html#kickWatchdog"><span class="hs-identifier hs-var">kickWatchdog</span></a></span><span> </span><span class="annot"><span class="annottext">Watchdog
</span><a href="#local-6989586621679128260"><span class="hs-identifier hs-var">watchdog</span></a></span><span>
</span><span id="line-96"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Watchdog
</span><a href="#local-6989586621679128260"><span class="hs-identifier hs-var">watchdog</span></a></span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span class="hs-comment">-- | Run watchdog in a loop in the current thread. Usually this function should be used with 'H.withAsync'</span><span>
</span><span id="line-99"></span><span class="hs-comment">-- to run it in the background.</span><span>
</span><span id="line-100"></span><span id="local-6989586621679128390"><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#runWatchdog"><span class="hs-identifier hs-type">runWatchdog</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadBase</span></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679128390"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-101"></span><span>            </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#Watchdog"><span class="hs-identifier hs-type">Watchdog</span></a></span><span>
</span><span id="line-102"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679128390"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-103"></span><span id="runWatchdog"><span class="annot"><span class="annottext">runWatchdog :: forall (m :: * -&gt; *). MonadBase IO m =&gt; Watchdog -&gt; m ()
</span><a href="Hedgehog.Extras.Test.TestWatchdog.html#runWatchdog"><span class="hs-identifier hs-var hs-var">runWatchdog</span></a></span></span><span> </span><span id="local-6989586621679128244"><span class="annot"><span class="annottext">w :: Watchdog
</span><a href="#local-6989586621679128244"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#Watchdog"><span class="hs-identifier hs-type">Watchdog</span></a></span><span class="hs-special">{</span><span id="local-6989586621679128243"><span class="annot"><span class="annottext">ThreadId
watchedThreadId :: ThreadId
watchedThreadId :: Watchdog -&gt; ThreadId
</span><a href="#local-6989586621679128243"><span class="hs-identifier hs-var hs-var">watchedThreadId</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679128242"><span class="annot"><span class="annottext">UTCTime
startTime :: UTCTime
startTime :: Watchdog -&gt; UTCTime
</span><a href="#local-6989586621679128242"><span class="hs-identifier hs-var hs-var">startTime</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679128241"><span class="annot"><span class="annottext">TChan WatchdogCommand
kickChan :: TChan WatchdogCommand
kickChan :: Watchdog -&gt; TChan WatchdogCommand
</span><a href="#local-6989586621679128241"><span class="hs-identifier hs-var hs-var">kickChan</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (b :: * -&gt; *) (m :: * -&gt; *) &#945;. MonadBase b m =&gt; b &#945; -&gt; m &#945;
</span><span class="hs-identifier hs-var">liftBase</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-104"></span><span>  </span><span class="annot"><span class="annottext">forall a. STM a -&gt; IO a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. TChan a -&gt; STM (Maybe a)
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/stm-2.5.0.2/src"><span class="hs-identifier hs-var">tryReadTChan</span></a></span><span> </span><span class="annot"><span class="annottext">TChan WatchdogCommand
</span><a href="#local-6989586621679128241"><span class="hs-identifier hs-var">kickChan</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-105"></span><span>    </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">WatchdogCommand
</span><a href="Hedgehog.Extras.Test.TestWatchdog.html#PoisonPill"><span class="hs-identifier hs-var">PoisonPill</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-106"></span><span>      </span><span class="hs-comment">-- deactivate watchdog</span><span>
</span><span id="line-107"></span><span>      </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span>    </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#Kick"><span class="hs-identifier hs-type">Kick</span></a></span><span> </span><span id="local-6989586621679128238"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679128238"><span class="hs-identifier hs-var">timeout</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-109"></span><span>      </span><span class="hs-comment">-- got a kick, wait for another period</span><span>
</span><span id="line-110"></span><span>      </span><span class="annot"><span class="annottext">Int -&gt; IO ()
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">threadDelay</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679128238"><span class="hs-identifier hs-var">timeout</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1_000_000</span></span><span>
</span><span id="line-111"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadBase IO m =&gt; Watchdog -&gt; m ()
</span><a href="Hedgehog.Extras.Test.TestWatchdog.html#runWatchdog"><span class="hs-identifier hs-var">runWatchdog</span></a></span><span> </span><span class="annot"><span class="annottext">Watchdog
</span><a href="#local-6989586621679128244"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-112"></span><span>    </span><span class="annot"><span class="annottext">Maybe WatchdogCommand
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-113"></span><span>      </span><span class="hs-comment">-- we are out of scheduled timeouts, kill the monitored thread</span><span>
</span><span id="line-114"></span><span>      </span><span id="local-6989586621679128236"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621679128236"><span class="hs-identifier hs-var">currentTime</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO UTCTime
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/time-1.11.1.1/src"><span class="hs-identifier hs-var">getCurrentTime</span></a></span><span>
</span><span id="line-115"></span><span>      </span><span class="annot"><span class="annottext">forall e. Exception e =&gt; ThreadId -&gt; e -&gt; IO ()
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">throwTo</span></a></span><span> </span><span class="annot"><span class="annottext">ThreadId
</span><a href="#local-6989586621679128243"><span class="hs-identifier hs-var">watchedThreadId</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime -&gt; WatchdogException
</span><a href="Hedgehog.Extras.Test.TestWatchdog.html#WatchdogException"><span class="hs-identifier hs-var">WatchdogException</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime -&gt; UTCTime -&gt; NominalDiffTime
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/time-1.11.1.1/src"><span class="hs-identifier hs-var">diffUTCTime</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621679128236"><span class="hs-identifier hs-var">currentTime</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621679128242"><span class="hs-identifier hs-var">startTime</span></a></span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span class="hs-comment">-- | Watchdog command</span><span>
</span><span id="line-118"></span><span class="hs-keyword">data</span><span> </span><span id="WatchdogCommand"><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#WatchdogCommand"><span class="hs-identifier hs-var">WatchdogCommand</span></a></span></span><span>
</span><span id="line-119"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="Kick"><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#Kick"><span class="hs-identifier hs-var">Kick</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-comment">-- ^ Add another delay in seconds</span><span>
</span><span id="line-120"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="PoisonPill"><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#PoisonPill"><span class="hs-identifier hs-var">PoisonPill</span></a></span></span><span> </span><span class="hs-comment">-- ^ Stop the watchdog</span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span class="hs-comment">-- | Enqueue a kick for the watchdog. It will extend the timeout by another one defined in the watchdog</span><span>
</span><span id="line-123"></span><span class="hs-comment">-- configuration.</span><span>
</span><span id="line-124"></span><span id="local-6989586621679128392"><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#kickWatchdog"><span class="hs-identifier hs-type">kickWatchdog</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679128392"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#Watchdog"><span class="hs-identifier hs-type">Watchdog</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679128392"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-125"></span><span id="kickWatchdog"><span class="annot"><span class="annottext">kickWatchdog :: forall (m :: * -&gt; *). MonadIO m =&gt; Watchdog -&gt; m ()
</span><a href="Hedgehog.Extras.Test.TestWatchdog.html#kickWatchdog"><span class="hs-identifier hs-var hs-var">kickWatchdog</span></a></span></span><span> </span><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#Watchdog"><span class="hs-identifier hs-type">Watchdog</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">watchdogConfig :: Watchdog -&gt; WatchdogConfig
</span><a href="Hedgehog.Extras.Test.TestWatchdog.html#watchdogConfig"><span class="hs-identifier hs-var">watchdogConfig</span></a></span><span class="hs-glyph">=</span><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#WatchdogConfig"><span class="hs-identifier hs-type">WatchdogConfig</span></a></span><span class="hs-special">{</span><span id="local-6989586621679128231"><span class="annot"><span class="annottext">Int
watchdogTimeout :: Int
watchdogTimeout :: WatchdogConfig -&gt; Int
</span><a href="#local-6989586621679128231"><span class="hs-identifier hs-var hs-var">watchdogTimeout</span></a></span></span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679128230"><span class="annot"><span class="annottext">TChan WatchdogCommand
kickChan :: TChan WatchdogCommand
kickChan :: Watchdog -&gt; TChan WatchdogCommand
</span><a href="#local-6989586621679128230"><span class="hs-identifier hs-var hs-var">kickChan</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-126"></span><span>  </span><span class="annot"><span class="annottext">forall a. STM a -&gt; IO a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. TChan a -&gt; a -&gt; STM ()
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/stm-2.5.0.2/src"><span class="hs-identifier hs-var">writeTChan</span></a></span><span> </span><span class="annot"><span class="annottext">TChan WatchdogCommand
</span><a href="#local-6989586621679128230"><span class="hs-identifier hs-var">kickChan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; WatchdogCommand
</span><a href="Hedgehog.Extras.Test.TestWatchdog.html#Kick"><span class="hs-identifier hs-var">Kick</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679128231"><span class="hs-identifier hs-var">watchdogTimeout</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span class="hs-comment">-- | Enqueue a poison pill for the watchdog. It will stop the watchdog after all timeouts.</span><span>
</span><span id="line-129"></span><span id="local-6989586621679128228"><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#poisonWatchdog"><span class="hs-identifier hs-type">poisonWatchdog</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679128228"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#Watchdog"><span class="hs-identifier hs-type">Watchdog</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679128228"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-130"></span><span id="poisonWatchdog"><span class="annot"><span class="annottext">poisonWatchdog :: forall (m :: * -&gt; *). MonadIO m =&gt; Watchdog -&gt; m ()
</span><a href="Hedgehog.Extras.Test.TestWatchdog.html#poisonWatchdog"><span class="hs-identifier hs-var hs-var">poisonWatchdog</span></a></span></span><span> </span><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#Watchdog"><span class="hs-identifier hs-type">Watchdog</span></a></span><span class="hs-special">{</span><span id="local-6989586621679128225"><span class="annot"><span class="annottext">TChan WatchdogCommand
kickChan :: TChan WatchdogCommand
kickChan :: Watchdog -&gt; TChan WatchdogCommand
</span><a href="#local-6989586621679128225"><span class="hs-identifier hs-var hs-var">kickChan</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-131"></span><span>  </span><span class="annot"><span class="annottext">forall a. STM a -&gt; IO a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">atomically</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. TChan a -&gt; a -&gt; STM ()
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/stm-2.5.0.2/src"><span class="hs-identifier hs-var">writeTChan</span></a></span><span> </span><span class="annot"><span class="annottext">TChan WatchdogCommand
</span><a href="#local-6989586621679128225"><span class="hs-identifier hs-var">kickChan</span></a></span><span> </span><span class="annot"><span class="annottext">WatchdogCommand
</span><a href="Hedgehog.Extras.Test.TestWatchdog.html#PoisonPill"><span class="hs-identifier hs-var">PoisonPill</span></a></span><span>
</span><span id="line-132"></span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span class="hs-comment">-- | Execute a test case with a watchdog.</span><span>
</span><span id="line-135"></span><span id="local-6989586621679128368"><span id="local-6989586621679128370"><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#runWithWatchdog"><span class="hs-identifier hs-type">runWithWatchdog</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span>
</span><span id="line-136"></span><span>                </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadBaseControl</span></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679128370"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-137"></span><span>                </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#WatchdogConfig"><span class="hs-identifier hs-type">WatchdogConfig</span></a></span><span> </span><span class="hs-comment">-- ^ configuration</span><span>
</span><span id="line-138"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#Watchdog"><span class="hs-identifier hs-type">Watchdog</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679128370"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679128368"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ a test case to be wrapped in watchdog</span><span>
</span><span id="line-139"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679128370"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679128368"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-140"></span><span id="runWithWatchdog"><span class="annot"><span class="annottext">runWithWatchdog :: forall (m :: * -&gt; *) a.
(HasCallStack, MonadBaseControl IO m) =&gt;
WatchdogConfig -&gt; (HasCallStack =&gt; Watchdog -&gt; m a) -&gt; m a
</span><a href="Hedgehog.Extras.Test.TestWatchdog.html#runWithWatchdog"><span class="hs-identifier hs-var hs-var">runWithWatchdog</span></a></span></span><span> </span><span id="local-6989586621679128209"><span class="annot"><span class="annottext">WatchdogConfig
</span><a href="#local-6989586621679128209"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span id="local-6989586621679128208"><span class="annot"><span class="annottext">HasCallStack =&gt; Watchdog -&gt; m a
</span><a href="#local-6989586621679128208"><span class="hs-identifier hs-var">testCase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-141"></span><span>  </span><span id="local-6989586621679128207"><span class="annot"><span class="annottext">ThreadId
</span><a href="#local-6989586621679128207"><span class="hs-identifier hs-var">watchedThreadId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (b :: * -&gt; *) (m :: * -&gt; *) &#945;. MonadBase b m =&gt; b &#945; -&gt; m &#945;
</span><span class="hs-identifier hs-var">liftBase</span></span><span> </span><span class="annot"><span class="annottext">IO ThreadId
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">myThreadId</span></a></span><span>
</span><span id="line-142"></span><span>  </span><span id="local-6989586621679128206"><span class="annot"><span class="annottext">Watchdog
</span><a href="#local-6989586621679128206"><span class="hs-identifier hs-var">watchdog</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (b :: * -&gt; *) (m :: * -&gt; *) &#945;. MonadBase b m =&gt; b &#945; -&gt; m &#945;
</span><span class="hs-identifier hs-var">liftBase</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *).
MonadBase IO m =&gt;
WatchdogConfig -&gt; ThreadId -&gt; m Watchdog
</span><a href="Hedgehog.Extras.Test.TestWatchdog.html#makeWatchdog"><span class="hs-identifier hs-var">makeWatchdog</span></a></span><span> </span><span class="annot"><span class="annottext">WatchdogConfig
</span><a href="#local-6989586621679128209"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">ThreadId
</span><a href="#local-6989586621679128207"><span class="hs-identifier hs-var">watchedThreadId</span></a></span><span>
</span><span id="line-143"></span><span>  </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b.
MonadBaseControl IO m =&gt;
m a -&gt; (Async (StM m a) -&gt; m b) -&gt; m b
</span><span class="hs-identifier hs-var">H.withAsync</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadBase IO m =&gt; Watchdog -&gt; m ()
</span><a href="Hedgehog.Extras.Test.TestWatchdog.html#runWatchdog"><span class="hs-identifier hs-var">runWatchdog</span></a></span><span> </span><span class="annot"><span class="annottext">Watchdog
</span><a href="#local-6989586621679128206"><span class="hs-identifier hs-var">watchdog</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-144"></span><span>    </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Async (StM m ())
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Watchdog -&gt; m a
</span><a href="#local-6989586621679128208"><span class="hs-identifier hs-var">testCase</span></a></span><span> </span><span class="annot"><span class="annottext">Watchdog
</span><a href="#local-6989586621679128206"><span class="hs-identifier hs-var">watchdog</span></a></span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span class="hs-comment">-- | Execute a test case with a watchdog.</span><span>
</span><span id="line-147"></span><span id="local-6989586621679128357"><span id="local-6989586621679128358"><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#runWithWatchdog_"><span class="hs-identifier hs-type">runWithWatchdog_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span>
</span><span id="line-148"></span><span>                 </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadBaseControl</span></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679128358"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-149"></span><span>                 </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#WatchdogConfig"><span class="hs-identifier hs-type">WatchdogConfig</span></a></span><span> </span><span class="hs-comment">-- ^ configuration</span><span>
</span><span id="line-150"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679128358"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679128357"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ a test case to be wrapped in watchdog</span><span>
</span><span id="line-151"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679128358"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679128357"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-152"></span><span id="runWithWatchdog_"><span class="annot"><span class="annottext">runWithWatchdog_ :: forall (m :: * -&gt; *) a.
(HasCallStack, MonadBaseControl IO m) =&gt;
WatchdogConfig -&gt; (HasCallStack =&gt; m a) -&gt; m a
</span><a href="Hedgehog.Extras.Test.TestWatchdog.html#runWithWatchdog_"><span class="hs-identifier hs-var hs-var">runWithWatchdog_</span></a></span></span><span> </span><span id="local-6989586621679128199"><span class="annot"><span class="annottext">WatchdogConfig
</span><a href="#local-6989586621679128199"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span id="local-6989586621679128198"><span class="annot"><span class="annottext">HasCallStack =&gt; m a
</span><a href="#local-6989586621679128198"><span class="hs-identifier hs-var">testCase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
(HasCallStack, MonadBaseControl IO m) =&gt;
WatchdogConfig -&gt; (HasCallStack =&gt; Watchdog -&gt; m a) -&gt; m a
</span><a href="Hedgehog.Extras.Test.TestWatchdog.html#runWithWatchdog"><span class="hs-identifier hs-var">runWithWatchdog</span></a></span><span> </span><span class="annot"><span class="annottext">WatchdogConfig
</span><a href="#local-6989586621679128199"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; m a
</span><a href="#local-6989586621679128198"><span class="hs-identifier hs-var">testCase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span class="hs-comment">-- | Execute a test case with watchdog with default config.</span><span>
</span><span id="line-155"></span><span id="local-6989586621679128351"><span id="local-6989586621679128352"><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#runWithDefaultWatchdog"><span class="hs-identifier hs-type">runWithDefaultWatchdog</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span>
</span><span id="line-156"></span><span>                       </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadBaseControl</span></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679128352"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-157"></span><span>                       </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#Watchdog"><span class="hs-identifier hs-type">Watchdog</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679128352"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679128351"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ a test case to be wrapped in watchdog</span><span>
</span><span id="line-158"></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679128352"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679128351"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-159"></span><span id="runWithDefaultWatchdog"><span class="annot"><span class="annottext">runWithDefaultWatchdog :: forall (m :: * -&gt; *) a.
(HasCallStack, MonadBaseControl IO m) =&gt;
(HasCallStack =&gt; Watchdog -&gt; m a) -&gt; m a
</span><a href="Hedgehog.Extras.Test.TestWatchdog.html#runWithDefaultWatchdog"><span class="hs-identifier hs-var hs-var">runWithDefaultWatchdog</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
(HasCallStack, MonadBaseControl IO m) =&gt;
WatchdogConfig -&gt; (HasCallStack =&gt; Watchdog -&gt; m a) -&gt; m a
</span><a href="Hedgehog.Extras.Test.TestWatchdog.html#runWithWatchdog"><span class="hs-identifier hs-var">runWithWatchdog</span></a></span><span> </span><span class="annot"><span class="annottext">WatchdogConfig
</span><a href="Hedgehog.Extras.Test.TestWatchdog.html#defaultWatchdogConfig"><span class="hs-identifier hs-var">defaultWatchdogConfig</span></a></span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span class="hs-comment">-- | Execute a test case with watchdog with default config.</span><span>
</span><span id="line-162"></span><span id="local-6989586621679128348"><span id="local-6989586621679128349"><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#runWithDefaultWatchdog_"><span class="hs-identifier hs-type">runWithDefaultWatchdog_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span>
</span><span id="line-163"></span><span>                        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadBaseControl</span></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679128349"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-164"></span><span>                        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679128349"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679128348"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ a test case to be wrapped in watchdog</span><span>
</span><span id="line-165"></span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679128349"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679128348"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-166"></span><span id="runWithDefaultWatchdog_"><span class="annot"><span class="annottext">runWithDefaultWatchdog_ :: forall (m :: * -&gt; *) a.
(HasCallStack, MonadBaseControl IO m) =&gt;
(HasCallStack =&gt; m a) -&gt; m a
</span><a href="Hedgehog.Extras.Test.TestWatchdog.html#runWithDefaultWatchdog_"><span class="hs-identifier hs-var hs-var">runWithDefaultWatchdog_</span></a></span></span><span> </span><span id="local-6989586621679128181"><span class="annot"><span class="annottext">HasCallStack =&gt; m a
</span><a href="#local-6989586621679128181"><span class="hs-identifier hs-var">testCase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
(HasCallStack, MonadBaseControl IO m) =&gt;
(HasCallStack =&gt; Watchdog -&gt; m a) -&gt; m a
</span><a href="Hedgehog.Extras.Test.TestWatchdog.html#runWithDefaultWatchdog"><span class="hs-identifier hs-var">runWithDefaultWatchdog</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. a -&gt; b -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; m a
</span><a href="#local-6989586621679128181"><span class="hs-identifier hs-var">testCase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span>
</span><span id="line-168"></span><span class="hs-comment">-- | An exception thrown to the test case thread.</span><span>
</span><span id="line-169"></span><span class="hs-keyword">newtype</span><span> </span><span id="WatchdogException"><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#WatchdogException"><span class="hs-identifier hs-var">WatchdogException</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="WatchdogException"><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#WatchdogException"><span class="hs-identifier hs-var">WatchdogException</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="timeElapsed"><span class="annot"><span class="annottext">WatchdogException -&gt; NominalDiffTime
</span><a href="Hedgehog.Extras.Test.TestWatchdog.html#timeElapsed"><span class="hs-identifier hs-var hs-var">timeElapsed</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/time-1.11.1.1/src"><span class="hs-identifier hs-type">NominalDiffTime</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679128172"><span id="local-6989586621679128175"><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#WatchdogException"><span class="hs-identifier hs-type">WatchdogException</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-172"></span><span>  </span><span id="local-6989586621679128161"><span class="annot"><span class="annottext">show :: WatchdogException -&gt; String
</span><a href="#local-6989586621679128161"><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></a></span></span><span> </span><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#WatchdogException"><span class="hs-identifier hs-type">WatchdogException</span></a></span><span class="hs-special">{</span><span id="local-6989586621679128160"><span class="annot"><span class="annottext">NominalDiffTime
timeElapsed :: NominalDiffTime
timeElapsed :: WatchdogException -&gt; NominalDiffTime
</span><a href="#local-6989586621679128160"><span class="hs-identifier hs-var hs-var">timeElapsed</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-173"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;WatchdogException: Test watchdog killed test case thread after &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (RealFrac a, Integral b) =&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">round</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime -&gt; Pico
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/time-1.11.1.1/src"><span class="hs-identifier hs-var">nominalDiffTimeToSeconds</span></a></span><span> </span><span class="annot"><span class="annottext">NominalDiffTime
</span><a href="#local-6989586621679128160"><span class="hs-identifier hs-var">timeElapsed</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; seconds.&quot;</span></span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679128149"><span id="local-6989586621679128151"><span id="local-6989586621679128153"><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.5/share/doc/ghc-9.2.5/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Exception</span></a></span><span> </span><span class="annot"><a href="Hedgehog.Extras.Test.TestWatchdog.html#WatchdogException"><span class="hs-identifier hs-type">WatchdogException</span></a></span></span></span></span><span>
</span><span id="line-176"></span></pre></body></html>